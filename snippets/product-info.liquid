{%- assign selected_variant = product.selected_or_first_available_variant -%}

<div class="card {% if product.media.size > 0 %}card--collapsed{% endif %} {% if template.name == 'product' %}card--sticky{% endif %}">
  {%- if section.settings.enable_image_zoom -%}
    <div id="product-zoom-{{ section.id }}" class="product__zoom-wrapper"></div>
  {%- endif -%}

  <div class="card__section">
    {% comment %}
    ------------------------------------------------------------------------------
    PRODUCT META
    ------------------------------------------------------------------------------
    {% endcomment %}

    {%- if section.settings.show_share_buttons -%}
      {%- capture share_buttons -%}
        {%- assign share_url = shop.url | append: product.url -%}
        {%- assign twitter_text = product.title | url_param_escape -%}
        {%- assign pinterest_description = product.description | strip_html | truncatewords: 15 | url_param_escape -%}
        {%- assign pinterest_image = product.featured_media | img_url: '1024x' | prepend: 'https:' -%}

        <ul class="social-media__item-list list--unstyled">
          <li class="social-media__item social-media__item--facebook">
            <a href="https://www.facebook.com/sharer.php?u={{ share_url }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.facebook_share' | t }}">{%- render 'icon', icon: 'facebook' -%}</a>
          </li>

          <li class="social-media__item social-media__item--pinterest">
            <a href="https://pinterest.com/pin/create/button/?url={{ share_url }}{% if pinterest_image != blank %}&media={{ pinterest_image }}{% endif %}&description={{ pinterest_description }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.pinterest_pin' | t }}">{%- render 'icon', icon: 'pinterest' -%}</a>
          </li>

          <li class="social-media__item social-media__item--twitter">
            <a href="https://twitter.com/share?{% if twitter_text != blank %}text={{twitter_text}}&{% endif %}url={{ share_url }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.twitter_tweet' | t }}">{%- render 'icon', icon: 'twitter' -%}</a>
          </li>

          <li class="social-media__item">
            <a href="mailto:?&subject={{ product.title | escape }}&body={{ share_url }}" aria-label="{{ 'general.social.email_share' | t }}">{% render 'icon', icon: 'email' %}</a>
          </li>
        </ul>
      {%- endcapture -%}
    {%- endif -%}

    <div class="product-meta">
      {%- if template.name == 'product' and template != 'product.quick-view' -%}
        <h1 class="product-meta__title heading h1">{{ product.title }}</h1>
      {%- else -%}
        <h3 class="product-meta__title heading h2">
          <a href="{{ product.url }}">{{ product.title }}</a>
        </h3>
      {%- endif -%}

      {%- comment -%}
====================================================
RESUMO DE AVALIAÇÕES NO PRODUTO
Adicionar no product-info.liquid após o título
====================================================
{%- endcomment -%}

{%- assign reviews_data = product.metafields.custom.reviews_json.value | default: product.metafields.custom.reviews_do_produto.value -%}

{%- if reviews_data and reviews_data.size > 0 -%}
  {%- assign total_reviews = reviews_data.size -%}
  {%- assign total_rating = 0 -%}

  {%- comment -%} Calcular média das avaliações {%- endcomment -%}
  {%- for review in reviews_data -%}
    {%- assign r_note = review.rating | default: review.nota | plus: 0 -%}
    {%- assign total_rating = total_rating | plus: r_note -%}
  {%- endfor -%}

  {%- assign average_rating = total_rating | times: 1.0 | divided_by: total_reviews -%}
  {%- assign full_stars = average_rating | floor -%}
  {%- assign decimal = average_rating | minus: full_stars -%}
  {%- assign next_star = full_stars | plus: 1 -%}

  {%- comment -%} EXIBIR RESUMO {%- endcomment -%}
  <div class="product-reviews-summary">
    <a href="#reviews-section" class="reviews-summary-link" data-scroll-to-reviews>
      <div class="reviews-stars-display">
        {%- for i in (1..5) -%}
          {%- if i <= full_stars -%}
            <span class="star-filled">★</span>
          {%- elsif decimal >= 0.25 and i == next_star -%}
            <span class="star-half">★</span>
          {%- else -%}
            <span class="star-empty">☆</span>
          {%- endif -%}
        {%- endfor -%}
      </div>
      
      <span class="reviews-rating-number">{{ average_rating | round: 1 }}</span>
      
      <span class="reviews-count">
        ({{ total_reviews }} {% if total_reviews == 1 %}avaliação{% else %}avaliações{% endif %})
      </span>
    </a>
  </div>

{%- endif -%}

<style>
/* Resumo de Avaliações no Produto */
.product-reviews-summary {
  margin: -20px 0 0 0;
  padding: 8px 0;
}

.reviews-summary-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  transition: opacity 0.2s ease;
  cursor: pointer;
}

.reviews-summary-link:hover {
  opacity: 0.8;
}

.reviews-stars-display {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  font-size: 18px;
  line-height: 1;
}

.reviews-stars-display .star-filled {
  color: #FFC107;
}

.reviews-stars-display .star-half {
  color: #FFC107;
  opacity: 0.5;
}

.reviews-stars-display .star-empty {
  color: #E0E0E0;
}

.reviews-rating-number {
  font-size: 14px;
  font-weight: 600;
  color: #1c1b1b;
  margin-left: 4px;
}

.reviews-count {
  font-size: 14px;
  color: #677279;
  text-decoration: underline;
}

.reviews-count:hover {
  color: #1c1b1b;
}

/* Responsivo */
@media (max-width: 768px) {
  .product-reviews-summary {
    margin: 10px 0;
  }

  .reviews-stars-display {
    font-size: 16px;
  }

  .reviews-rating-number {
    font-size: 13px;
  }

  .reviews-count {
    font-size: 13px;
  }
}

/* Animação de scroll suave */
html {
  scroll-behavior: smooth;
}
</style>

<script>
// Scroll suave até a seção de reviews
document.addEventListener('DOMContentLoaded', function() {
  const reviewsLink = document.querySelector('[data-scroll-to-reviews]');
  
  if (reviewsLink) {
    reviewsLink.addEventListener('click', function(e) {
      e.preventDefault();
      const reviewsSection = document.getElementById('reviews-section');
      
      if (reviewsSection) {
        const offsetTop = reviewsSection.getBoundingClientRect().top + window.pageYOffset - 80;
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
      }
    });
  }
});
</script>

      {%- capture product_labels -%}
        {%- for tag in product.tags -%}
          {%- if tag contains '__label:' -%}
            <span class="product-label product-label--custom1">{{ tag | split: '__label:' | last }}</span>
          {%- endif -%}

          {%- if tag contains '__label1:' -%}
            <span class="product-label product-label--custom1">{{ tag | split: '__label1:' | last }}</span>
          {%- endif -%}

          {%- if tag contains '__label2:' -%}
            <span class="product-label product-label--custom2">{{ tag | split: '__label2:' | last }}</span>
          {%- endif -%}
        {%- endfor -%}

        {%- if settings.show_discount -%}
          {%- assign savings = 0 -%}

          {%- if settings.discount_mode == 'percentage' -%}
            {%- assign savings = selected_variant.compare_at_price | minus: selected_variant.price | times: 100.0 | divided_by: selected_variant.compare_at_price | round | append: '%' -%}
          {%- else -%}
            {%- capture savings -%}<span>{{ selected_variant.compare_at_price | minus: selected_variant.price | money_without_trailing_zeros }}</span>{%- endcapture -%}
          {%- endif -%}

          <span class="product-label product-label--on-sale" {% unless selected_variant.price < selected_variant.compare_at_price %}style="display: none"{% endunless %}>{{ 'collection.product.discount_html' | t: savings: savings }}</span>
        {%- endif -%}
      {%- endcapture -%}

      {%- if product_labels != blank -%}
        <div class="product-meta__label-list">
          {{- product_labels -}}
        </div>
      {%- endif -%}

      {%- if section.settings.show_vendor or section.settings.show_sku -%}
        <div class="product-meta__reference">
          {%- if section.settings.show_vendor -%}
            {%- assign vendor_handle = product.vendor | handle -%}
            {%- assign collection_for_vendor = collections[vendor_handle] -%}

            {%- unless collection_for_vendor.empty? -%}
              <a class="product-meta__vendor link link--accented" href="{{ collection_for_vendor.url }}">{{ product.vendor }}</a>
            {%- else -%}
              <a class="product-meta__vendor link link--accented" href="{{ product.vendor | url_for_vendor }}">{{ product.vendor }}</a>
            {%- endunless -%}
          {%- endif -%}

          {%- if section.settings.show_sku -%}
            <span class="product-meta__sku" {% if selected_variant.sku == blank %}style="display: none"{% endif %}>
              {{- 'product.general.sku' | t -}} <span class="product-meta__sku-number">{{ selected_variant.sku }}</span>
            </span>
          {%- endif -%}
        </div>
      {%- endif -%}

      {%- if section.settings.show_reviews_badge -%}
        <a href="{% if template.name != 'product' or template == 'product.quick-view' %}{{ product.url | within: collection }}{% endif %}#product-reviews" class="product-meta__reviews-badge link" data-offset="30">
          <span class="shopify-product-reviews-badge" data-id="{{ product.id }}">
            {%- comment -%}Display a placeholder, to allocate space{%- endcomment -%}
            <div class="spr-badge" style="opacity: 0">
              <span class="spr-starrating spr-badge-starrating">
                <i class="spr-icon spr-icon-star-empty"></i>
                <i class="spr-icon spr-icon-star-empty"></i>
                <i class="spr-icon spr-icon-star-empty"></i>
                <i class="spr-icon spr-icon-star-empty"></i>
                <i class="spr-icon spr-icon-star-empty"></i>
              </span>

              <span class="spr-badge-caption">filler</span>
            </div>
          </span>
        </a>
      {%- endif -%}

      {%- if section.settings.show_share_buttons -%}
        <div class="product-meta__share-buttons hidden-phone">
          {{ share_buttons }}
        </div>
      {%- endif -%}
    </div>

    <hr class="card__separator">

    {%- if request.page_type == 'index' and section.settings.show_description and product.description != blank and section.settings.description_below_add_to_cart == false -%}
      <div class="product-meta__description rte">
        {{ product.description | remove: 'data-section-type="product"' }}
      </div>
    {%- endif -%}

    {% comment %}
    ------------------------------------------------------------------------------
    PRODUCT FORM
    ------------------------------------------------------------------------------
    {% endcomment %}

    {%- assign color_label = 'color,colour,couleur,cor,colore,farbe,색,色,カラー,färg,farve' | split: ',' -%}

    {%- form 'product', product, class: 'product-form' -%}
      {%- unless product.has_only_default_variant -%}
        <div class="product-form__variants">
          {%- for option in product.options_with_values -%}
            {%- assign downcase_option = option.name | downcase -%}
            {%- capture option_name -%}{{ section.id }}-{{ product.id }}-{{ forloop.index }}{%- endcapture -%}

            {%- assign option_selector_type = 'select' -%}

            {%- if section.settings.color_mode != 'block' and section.settings.color_mode != 'dropdown' and color_label contains downcase_option -%}
              {%- comment -%}NOTE: even if the merchant is using the mode to display variant images, if ALL variant do not have an associated image, we fallback to color{%- endcomment -%}

              {%- assign has_image_attached_to_all_variants = true -%}

              {%- for variant in product.variants -%}
                {%- unless variant.image -%}
                  {%- assign has_image_attached_to_all_variants = false -%}
                  {%- break -%}
                {%- endunless -%}
              {%- endfor -%}

              {%- if section.settings.color_mode == 'color' or has_image_attached_to_all_variants == false -%}
                {%- assign option_selector_type = 'color' -%}
              {%- else -%}
                {%- assign option_selector_type = 'variant' -%}
              {%- endif -%}
            {%- else -%}
              {%- if color_label contains downcase_option -%}
                {%- if section.settings.color_mode == 'block' -%}
                  {%- assign option_selector_type = 'block' -%}
                {%- endif -%}
              {%- elsif section.settings.selector_mode == 'block' -%}
                {%- assign option_selector_type = 'block' -%}
              {%- endif -%}
            {%- endif -%}

            <div class="product-form__option" data-selector-type="{{ option_selector_type }}">
              {%- case option_selector_type -%}
                {%- when 'color' -%}
                  <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

                  <div class="color-swatch-list color-swatch-list--large">
                    {%- for value in option.values -%}
                      {%- assign downcased_value = value | downcase -%}
                      {%- capture color_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                      {%- assign color_swatch_name = value | handle | append: '.png' -%}
                      {%- assign color_swatch_image = images[color_swatch_name] -%}

                      <div class="color-swatch {% if downcased_value == 'white' or downcased_value == 'blanc' %}color-swatch--white{% endif %}">
                        <input class="color-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ color_id }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}" aria-hidden="true">
                        <label class="color-swatch__item lazyload" for="{{ color_id }}" {% if color_swatch_image != blank %}data-bg="{{ color_swatch_image | img_url: '64x64' }}"{% else %}style="background-color: {{ value | replace: ' ', '' | downcase }}"{% endif %} title="{{ value | escape }}">{% render 'icon', icon: 'cross-sold-out' %}</label>
                      </div>
                    {%- endfor -%}
                  </div>
                {%- when 'variant' -%}
                  <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

                  <div class="variant-swatch-list">
                    {%- capture option_name -%}option{{ option.position }}{%- endcapture -%}

                    {%- for value in option.values -%}
                      {%- capture variant_swatch_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                      {%- for variant in product.variants -%}
                        {%- if variant[option_name] == value and variant.image -%}
                          <div class="variant-swatch">
                            <input class="variant-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ variant_swatch_id }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}">

                            <label class="variant-swatch__item" for="{{ variant_swatch_id }}" title="{{ value | escape }}">
                              <div class="aspect-ratio" style="padding-bottom: {{ 100.0 | divided_by: variant.image.aspect_ratio }}%">
                                <img src="{{ variant.image | img_url: '120x' }}" alt="{{ variant.image.alt | escape }}">
                              </div>

                              {% render 'icon', icon: 'cross-sold-out' %}
                            </label>
                          </div>

                          {%- break -%}
                        {%- endif -%}
                      {%- endfor -%}
                    {%- endfor -%}
                  </div>
                {%- when 'block' -%}
                  <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

                  <div class="block-swatch-list">
                    {%- for value in option.values -%}
                      {%- capture block_swatch_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                      <div class="block-swatch">
                        <input class="block-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ block_swatch_id }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}" aria-hidden="true">
                        <label class="block-swatch__item" for="{{ block_swatch_id }}" title="{{ value | escape }}">
                          <span class="block-swatch__item-text">{{ value }}</span>
                        </label>
                      </div>
                    {%- endfor -%}
                  </div>
                {%- when 'select' -%}
                  <label for="{{ option_name }}" class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></label>

                  <div class="select-wrapper select-wrapper--primary">
                    {%- render 'icon', icon: 'arrow-bottom' -%}

                    <select class="product-form__single-selector" name="{{ option_name }}" id="{{ option_name }}" data-option-position="{{ option.position }}">
                      {%- for value in option.values -%}
                        <option value="{{ value | escape }}" {% if value == option.selected_value %}selected="selected"{% endif %}>{{ value }}</option>
                      {%- endfor -%}
                    </select>
                  </div>
              {%- endcase -%}
            </div>
          {%- endfor -%}

          <div class="no-js product-form__option">
            <label for="product-select-{{ product.id }}">{{ 'product.form.variant' | t }}</label>

            <div class="select-wrapper select-wrapper--primary">
              <select id="product-select-{{ product.id }}" name="id">
                {%- for variant in product.variants -%}
                  <option {% if variant == selected_variant %}selected="selected"{% endif %} {% unless variant.available %}disabled="disabled"{% endunless %} value="{{ variant.id }}" data-sku="{{ variant.sku }}">{{ variant.title }} - {{ variant.price | money }}</option>
                {%- endfor -%}
              </select>
            </div>
          </div>
        </div>
      {%- else -%}
        <input type="hidden" name="id" data-sku="{{ selected_variant.sku }}" value="{{ selected_variant.id }}">
      {%- endunless -%}

      <div class="product-form__info-list">
        <div class="product-form__info-item">
          <span class="product-form__info-title text--strong">{{ 'product.form.price' | t }}:</span>

          <div class="product-form__info-content">
  <div class="price-list">
    {%- if selected_variant.compare_at_price > selected_variant.price -%}
  <span class="price price--highlight">{{ selected_variant.price | money_without_trailing_zeros }}</span>
  <span class="price price--compare">{{ selected_variant.compare_at_price | money_without_trailing_zeros }}</span>
{%- else -%}
  <span class="price">{{ selected_variant.price | money_without_trailing_zeros }}</span>
{%- endif -%}
  </div>

  <!-- CÓDIGO DE PARCELAMENTO AQUI -->
{%- comment -%}
====================================================
PARCELAMENTO SIMPLES
Adicionar após o preço no product-info.liquid
====================================================
{%- endcomment -%}

{%- if settings.show_installments -%}
  {%- assign max_installments = settings.max_installments -%}
  {%- assign product_price = selected_variant.price -%}
  
  {%- comment -%} Calcular a melhor parcela (maior parcela sem juros ou última com menor juros) {%- endcomment -%}
  {%- assign best_installment = 1 -%}
  {%- assign best_installment_price = product_price -%}
  {%- assign best_has_interest = false -%}
  
  {%- for i in (1..max_installments) -%}
    {%- capture interest_key -%}interest_{{ i }}x{%- endcapture -%}
    {%- assign current_interest = settings[interest_key] | times: 1.0 -%}
    
    {%- if current_interest == 0 -%}
      {%- assign best_installment = i -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- comment -%} Se todas têm juros, pegar a última {%- endcomment -%}
  {%- if best_installment == 1 and max_installments > 1 -%}
    {%- assign best_installment = max_installments -%}
  {%- endif -%}
  
  {%- comment -%} Calcular valor da parcela {%- endcomment -%}
  {%- capture interest_setting -%}interest_{{ best_installment }}x{%- endcapture -%}
  {%- assign installment_interest = settings[interest_setting] | times: 1.0 -%}
  
  {%- if installment_interest > 0 -%}
    {%- assign interest_multiplier = installment_interest | divided_by: 100.0 | times: best_installment | plus: 1 -%}
    {%- assign total_with_interest = product_price | times: interest_multiplier -%}
    {%- assign installment_price = total_with_interest | divided_by: best_installment -%}
    {%- assign best_has_interest = true -%}
  {%- else -%}
    {%- assign installment_price = product_price | divided_by: best_installment -%}
    {%- assign best_has_interest = false -%}
  {%- endif -%}

  {%- comment -%} EXIBIR PARCELAMENTO {%- endcomment -%}
  {%- if best_installment > 1 -%}
    <div class="product-installment">
      <svg class="installment-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
        <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
        <path d="M2 10H22" stroke="currentColor" stroke-width="2"/>
      </svg>
      
      <span class="installment-text">
        ou em até <strong >{{ best_installment }}x</strong> de 
        <strong class="no-interest">{{ installment_price | money_without_trailing_zeros }}</strong>
        
        {%- if best_has_interest -%}
          <span class="with-interest"> com juros</span>
        {%- else -%}
          <span class="no-interest"> </span>
        {%- endif -%}
      </span>

      {%- if settings.show_installment_table -%}
        <button type="button" class="installment-toggle" onclick="toggleInstallmentTable()">
          Ver todas as parcelas
        </button>
      {%- endif -%}
    </div>

    {%- comment -%} TABELA DE PARCELAS {%- endcomment -%}
    {%- if settings.show_installment_table -%}
      <div id="installment-table-modal" class="installment-modal" style="display: none;">
        <div class="installment-modal-content">
          <div class="installment-modal-header">
            <h3>Opções de Parcelamento</h3>
            <button type="button" class="installment-close" onclick="toggleInstallmentTable()">×</button>
          </div>
          
          <div class="installment-modal-body">
            <table class="installment-table">
              <thead>
                <tr>
                  <th>Parcelas</th>
                  <th>Valor/Parcela</th>
                  <th>Total</th>
                  <th>Juros</th>
                </tr>
              </thead>
              <tbody>
                {%- for i in (1..max_installments) -%}
                  {%- capture interest_key -%}interest_{{ i }}x{%- endcapture -%}
                  {%- assign interest = settings[interest_key] | times: 1.0 -%}
                  
                  {%- if interest > 0 -%}
                    {%- assign mult = interest | divided_by: 100.0 | times: i | plus: 1 -%}
                    {%- assign total = product_price | times: mult -%}
                    {%- assign parcela = total | divided_by: i -%}
                    {%- assign has_interest = true -%}
                  {%- else -%}
                    {%- assign parcela = product_price | divided_by: i -%}
                    {%- assign total = product_price -%}
                    {%- assign has_interest = false -%}
                  {%- endif -%}
                  
                  <tr class="{% if has_interest %}row-interest{% else %}row-no-interest{% endif %}">
                    <td><strong>{{ i }}x</strong></td>
                    <td><strong>{{ parcela | money_without_trailing_zeros }}</strong></td>
                    <td>{{ total | money_without_trailing_zeros }}</td>
                    <td class="{% if has_interest %}text-interest{% else %}text-no-interest{% endif %}">
                      {%- if has_interest -%}
                        {{ interest }}% a.m.
                      {%- else -%}
                        Sem juros
                      {%- endif -%}
                    </td>
                  </tr>
                {%- endfor -%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

<style>
/* Parcelamento inline */
.product-installment {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 0;
  border-top: 1px solid #f3f4f6;
  margin-top: 10px;
  flex-wrap: wrap;
}

.installment-icon {
  flex-shrink: 0;
  color: #677279;
}

.installment-text {
  font-size: 14px;
  color: #677279;
  line-height: 1.5;
}

.installment-text strong {
  color: #1c1b1b;
  font-weight: 600;
}

.installment-text .no-interest {
  color: #22c55e;
  font-weight: 500;
}

.installment-text .with-interest {
  color: #f59e0b;
  font-weight: 500;
}

.installment-toggle {
  background: none;
  border: none;
  color: #2eb82e;
  font-size: 13px;
  text-decoration: underline;
  cursor: pointer;
  padding: 0;
  margin-left: auto;
}

.installment-toggle:hover {
  color: #25a125;
}

/* Modal da tabela */
.installment-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.installment-modal-content {
  background: #fff;
  border-radius: 12px;
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.installment-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px;
  border-bottom: 1px solid #e5e5e5;
}

.installment-modal-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1c1b1b;
  margin: 0;
}

.installment-close {
  background: none;
  border: none;
  font-size: 32px;
  color: #9ca3af;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.installment-close:hover {
  color: #1c1b1b;
}

.installment-modal-body {
  padding: 20px;
  overflow-y: auto;
  max-height: calc(80vh - 80px);
}

.installment-table {
  width: 100%;
  border-collapse: collapse;
}

.installment-table th {
  background: #f9fafb;
  padding: 12px;
  text-align: left;
  font-size: 13px;
  font-weight: 600;
  color: #1c1b1b;
  border-bottom: 2px solid #e5e5e5;
}

.installment-table td {
  padding: 12px;
  font-size: 14px;
  color: #677279;
  border-bottom: 1px solid #f3f4f6;
}

.installment-table .row-interest {
  background: #fffbeb;
}

.installment-table .text-no-interest {
  color: #22c55e;
  font-weight: 500;
}

.installment-table .text-interest {
  color: #f59e0b;
  font-weight: 500;
}

@media (max-width: 768px) {
  .product-installment {
    padding: 8px 0;
  }

  .installment-text {
    font-size: 13px;
  }

  .installment-modal-content {
    max-height: 90vh;
  }

  .installment-table th,
  .installment-table td {
    padding: 10px 8px;
    font-size: 12px;
  }
}
</style>

<script>
function toggleInstallmentTable() {
  const modal = document.getElementById('installment-table-modal');
  if (modal.style.display === 'none' || !modal.style.display) {
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  } else {
    modal.style.display = 'none';
    document.body.style.overflow = '';
  }
}

// Fechar ao clicar fora do modal
document.addEventListener('click', function(e) {
  const modal = document.getElementById('installment-table-modal');
  if (e.target === modal) {
    toggleInstallmentTable();
  }
});
</script>

  <!-- FIM DE PARCELAMENTO AQUI -->

<style>
.product-installment {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    padding: 8px 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}

.product-installment__icon {
    flex-shrink: 0;
    width: 16px;
    height: 16px;
    color: var(--text-color, #677279);
}

.product-installment__text {
    font-size: 14px;
    color: var(--text-color, #677279);
    line-height: 1.4;
}

.product-installment__text strong {
    color: var(--heading-color, #1c1b1b);
    font-weight: 600;
}

@media (max-width: 480px) {
    .product-installment {
        margin-top: 6px;
        padding: 6px 0;
    }
    
    .product-installment__text {
        font-size: 13px;
    }
}
</style>

            <div class="product-form__price-info" style="display: {% if selected_variant.unit_price_measurement %}block{% else %}none{% endif %}">
              <div class="unit-price-measurement">
                <span class="unit-price-measurement__price">{{ selected_variant.unit_price | money_without_trailing_zeros }}</span>
                <span class="unit-price-measurement__separator">/ </span>

                {%- if selected_variant.unit_price_measurement.reference_value != 1 -%}
                  <span class="unit-price-measurement__reference-value">{{ selected_variant.unit_price_measurement.reference_value }}</span>
                {%- endif -%}

                <span class="unit-price-measurement__reference-unit">{{ selected_variant.unit_price_measurement.reference_unit }}</span>
              </div>
            </div>

            {%- if section.settings.show_taxes_included -%}
              {%- if shop.taxes_included or shop.shipping_policy.body != blank -%}
                <p class="product-form__price-info">
                  {%- if shop.taxes_included -%}
                    {{ 'product.general.include_taxes' | t }}
                  {%- endif -%}

                  {%- if shop.shipping_policy.body != blank -%}
                    {{ 'product.general.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                  {%- endif -%}
                </p>
              {%- endif -%}
            {%- endif -%}
          </div>
        </div>

        {%- if section.settings.show_inventory_quantity and product.template_suffix != 'pre-order' -%}
          <div class="product-form__info-item">
            <span class="product-form__info-title text--strong">{{ 'product.form.inventory' | t }}:</span>

            <div class="product-form__info-content">
              {%- if selected_variant.available -%}
                {%- if selected_variant.inventory_management and selected_variant.inventory_policy == 'deny' and section.settings.low_inventory_threshold > 0 -%}
                  {%- if selected_variant.inventory_quantity <= section.settings.low_inventory_threshold -%}
                    <span class="product-form__inventory inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count: selected_variant.inventory_quantity }}</span>
                  {%- else -%}
                    <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock_with_quantity_count' | t: count: selected_variant.inventory_quantity }}</span>
                  {%- endif -%}
                {%- else -%}
                  {%- if selected_variant.inventory_policy == 'continue' and selected_variant.inventory_quantity <= 0 -%}
                    <span class="product-form__inventory inventory inventory--high">{{ 'product.form.oversell_stock' | t }}</span>
                  {%- else -%}
                    <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
                  {%- endif -%}
                {%- endif -%}
              {%- else -%}
                <span class="product-form__inventory inventory">{{ 'product.form.sold_out' | t }}</span>
              {%- endif -%}

              {%- for tag in product.tags -%}
                {%- if tag contains '__stock:' -%}
                  {%- assign stock_countdown_max = tag | split: '__stock:' | last | times: 1.0 -%}
                  {%- assign stock_countdown_progress = selected_variant.inventory_quantity | divided_by: stock_countdown_max | times: 100.0 | at_least: 0 | at_most: 100 -%}

                  <span class="inventory-bar {% if stock_countdown_progress == 0 %}inventory-bar--hidden{% endif %}" data-stock-countdown-max="{{ stock_countdown_max }}">
                    <span class="inventory-bar__progress" style="width: 100%"></span>
                  </span>
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}

        {%- if product.template_suffix != 'contact' -%}
          {%- if section.settings.show_quantity_selector -%}
            <div class="product-form__info-item product-form__info-item--quantity">
              <label for="{{ section.id }}-{{ product.id }}-quantity" class="product-form__info-title text--strong">{{ 'product.form.quantity' | t }}:</label>

              <div class="product-form__info-content">
                <div class="select-wrapper select-wrapper--small select-wrapper--primary">
                  {%- render 'icon', icon: 'arrow-bottom' -%}

                  <select name="quantity" id="{{ section.id }}-{{ product.id }}-quantity" class="product-form__quantity">
                    {%- for i in (1..10) -%}
                      <option value="{{ i }}" {% if forloop.first %}selected="selected"{% endif %}>{% if i < 10 %}{{ i }}{% else %}{{ i }}+{% endif %}</option>
                    {%- endfor -%}
                  </select>
                </div>
              </div>
            </div>
          {%- else -%}
            <input type="hidden" name="quantity" value="1">
          {%- endif -%}
        {%- endif -%}
      </div>

      <div class="product-form__payment-container">
        {%- if product.template_suffix != 'contact' -%}
          {%- if selected_variant.available -%}
            {%- if product.template_suffix == 'pre-order' -%}
              <button type="submit" class="product-form__add-button button button--primary" data-action="add-to-cart">{{ 'product.form.pre_order' | t }}</button>
            {%- else -%}
              <button type="submit" class="product-form__add-button button button--primary" data-action="add-to-cart">{{ 'product.form.add_to_cart' | t }}</button>
            {%- endif -%}
          {%- else -%}
            <button type="submit" class="product-form__add-button button button--disabled" disabled>{{ 'product.form.sold_out' | t }}</button>
          {%- endif -%}

          {%- if section.settings.show_payment_button -%}
            {{ form | payment_button }}
          {%- endif -%}
        {%- else -%}
          <a href="mailto:{{ shop.email }}" class="button button--primary">{{ 'product.form.contact_us' | t }}</a>
        {%- endif -%}
      </div>

      <!-- SELOS DE CONFIANÇA - ADICIONAR AQUI -->
<div class="trust-seals-wrapper">
  
  <!-- Selo 1: Frete Grátis -->
  <div class="trust-seal-item">
    <div class="trust-seal-icon">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6M10 21C10 21.5523 9.55228 22 9 22C8.44772 22 8 21.5523 8 21C8 20.4477 8.44772 20 9 20C9.55228 20 10 20.4477 10 21ZM21 21C21 21.5523 20.5523 22 20 22C19.4477 22 19 21.5523 19 21C19 20.4477 19.4477 20 20 20C20.5523 20 21 20.4477 21 21Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="trust-seal-content">
      <div class="trust-seal-title">Frete grátis para todo o Brasil</div>
    </div>
  </div>

  <!-- Selo 2: Produtos Originais -->
  <div class="trust-seal-item">
    <div class="trust-seal-icon">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 12L11 14L15 10M20.618 5.984C21.1256 6.49153 21.4997 7.12375 21.7022 7.81924C21.9048 8.51473 21.9286 9.25157 21.7711 9.95897C21.6137 10.6664 21.2803 11.3205 20.8023 11.8595C20.3243 12.3986 19.7171 12.8046 19.038 13.039L18.851 13.102L18.415 20.214C18.3902 20.592 18.2258 20.9485 17.9534 21.2121C17.681 21.4756 17.3199 21.6275 16.941 21.639L16.829 21.641H7.171C6.79296 21.6275 6.43186 21.4756 6.15947 21.2121C5.88707 20.9485 5.72262 20.592 5.698 20.214L5.262 13.102L5.075 13.039C4.36283 12.7955 3.72618 12.3621 3.23575 11.7865C2.74532 11.2109 2.41894 10.5136 2.29252 9.76628C2.1661 9.01898 2.24461 8.25091 2.51922 7.54471C2.79384 6.83851 3.25372 6.22348 3.851 5.763L3.984 5.663L11.191 0.904999C11.4318 0.743968 11.7126 0.658447 12 0.658447C12.2874 0.658447 12.5682 0.743968 12.809 0.904999L20.016 5.663L20.149 5.763L20.618 5.984Z" fill="currentColor"/>
      </svg>
    </div>
    <div class="trust-seal-content">
      <div class="trust-seal-title">Entrega e fatura à prova de curiosos</div>
    </div>
  </div>

  <!-- Selo 3: Compra Segura -->
  <div class="trust-seal-item">
    <div class="trust-seal-icon">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L3 7V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V7L12 2ZM10 17L6 13L7.41 11.59L10 14.17L16.59 7.58L18 9L10 17Z" fill="currentColor"/>
      </svg>
    </div>
    <div class="trust-seal-content">
      <div class="trust-seal-title">Garantia para problemas de fabricação*</div>
      <div class="trust-seal-description"></div>
    </div>
  </div>

</div>
<!-- FIM DOS SELOS -->

    {%- endform -%}

    {%- if request.page_type == 'index' and section.settings.show_description and product.description != blank and section.settings.description_below_add_to_cart -%}
      <div class="product-meta__description rte">
        {{ product.description }}
      </div>
    {%- endif -%}

    {%- if section.settings.show_share_buttons -%}
      <div class="product-meta__share-buttons hidden-tablet-and-up">
        <span class="text--strong">{{ 'product.general.share' | t }}</span>
        {{ share_buttons }}
      </div>
    {%- endif -%}
  </div>

  {%- if section.settings.show_payment_button and product.selected_or_first_available_variant.available == false -%}
    <style>
      #shopify-section-{{ section.id }} .shopify-payment-button {
        display: none;
      }
    </style>
  {%- endif -%}

  {% comment %}
  ------------------------------------------------------------------------------
  Product Data. This must be outputted for all products (including home page).

  IMPORTANT: THIS CODE IS VITAL. DO NOT EDIT IT NOT REMOVE IT. MAKE SURE TO KEEP
  THE EXACT SAME ATTRIBUTES.
  ------------------------------------------------------------------------------
  {% endcomment %}

  <script type="application/json" data-product-json>
    {
      "product": {{ product | json }},
      "options_with_values": {{ product.options_with_values | json }},
      "selected_variant_id": {{ selected_variant.id }}
      {%- if section.settings.show_inventory_quantity -%}
        ,"inventories": {
          {%- for variant in product.variants -%}
            {%- if variant.available -%}
              {%- if variant.inventory_management and variant.inventory_policy == 'deny' and section.settings.low_inventory_threshold > 0 -%}
                {%- if variant.inventory_quantity <= section.settings.low_inventory_threshold -%}
                  {%- capture inventory_message -%}{{ 'product.form.low_stock_with_quantity_count' | t: count: variant.inventory_quantity }}{%- endcapture -%}
                {%- else -%}
                  {%- capture inventory_message -%}{{ 'product.form.in_stock_with_quantity_count' | t: count: variant.inventory_quantity }}{%- endcapture -%}
                {%- endif -%}
              {%- else -%}
                {%- if variant.inventory_policy == 'continue' and variant.inventory_quantity <= 0 -%}
                  {%- capture inventory_message -%}{{ 'product.form.oversell_stock' | t }}{%- endcapture -%}
                {%- else %}
                  {%- capture inventory_message -%}{{ 'product.form.in_stock' | t }}{%- endcapture -%}
                {%- endif -%}
              {%- endif -%}
            {%- else -%}
              {%- capture inventory_message -%}{{ 'product.form.sold_out' | t }}{%- endcapture -%}
            {%- endif -%}

            "{{ variant.id }}": {
              "inventory_management": {{ variant.inventory_management | json }},
              "inventory_policy": {{ variant.inventory_policy | json }},
              "inventory_quantity": {{ variant.inventory_quantity | json }},
              "inventory_message": {{ inventory_message | json }}
            }{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        }
      {%- endif -%}
    }
  </script>
</div>